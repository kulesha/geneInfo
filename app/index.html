<!doctype html>
<html>
<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="/css/geneInfo.css">

    <!-- added to enable sticky goto box -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    
  
</head>
<body ng-app="geneInfoApp" data-spy="scroll" data-target="#myScrollspy">
    <a id="top" name="top" href="#"></a>
    <div class="jumbotron">        
        <nav class="navbar navbar-default" role="navigation" ng-controller="menuCtrl as menu">
            <script type="text/ng-template" id="myModalContent.html">
                <div class="modal-header">
                    <h3>{{ items[0] }}</h3>
                </div>
                <div class="modal-body" ng-switch on="items[0]">
                    <p ng-switch-when="Contact">Any enquiries please contact kulesha@gmail.com</p>
                    <p ng-switch-when="Help">This is a demo. The site will move to a new address in October 2014. Please contact kulesha@gmail.com if you want to be kept informed of the move.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" ng-click="ok()">OK</button>            
                </div>
            </script>
            
            <div class="navbar-header">
                <a class="navbar-brand" href="#">geneInspector ( demo )</a>
            </div
            <div class="pull-right">
                <ul class="nav navbar-nav pull-right">
                    <li><a href="#" ng-click="menu.show('Contact')">Contact</a></li>
                    <li><a href="#" ng-click="menu.show('Help')">Help</a></li>
                </ul>
            </div>
        </nav>
    </div>
    <div style="display:none;visibility:hidden"><pre id="tmp">ATGC : {{ fontWidth }}</pre> : </div> 
    
    <div ng-controller="geneInfoCtrl as gi">
        <form>
            <div class="pull-right" style="margin-right:20px">
                <span>Species: </span>
                <select style="height:30px" ng-options="obj.name as obj.display_name + ' ('+obj.assembly+')' for obj in gi.speciesList | orderBy:' display_name'" ng-model="gi.species">
                </select>
            </div>
            <div class="col-xs-3">
                <div class="input-group">
                    <input type="text" id="geneName" name="geneName" class="form-control" placeholder="Enter gene name" ng-model="formInfo.gene"/>    
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-success" ng-click="gi.findGene()">Find</button>
                    </span>
                </div>
            </div>                
            <div ng-show="message" style="text-align:center" ng-cloak>
                <span style="background-color:pink;margin-top:10px;">{{ message }}</span>
            </div>                           
        </form>
        
        
        <div ng-show="geneInfo.id" ng-controller="TabController as tab" ng-cloak id="data">
        
            <div id="location" style="position: fixed;display:none;z-index:1000;background-color:#333333;padding:5px;opacity:0.9;color:#ffffff;"> {{ location }} bp </div>            

            <table class="table table-condensed table-striped">
                <tr>
                    <th>Gene name</th><td><b>{{geneInfo.display_name}}</b> <em>(Ensembl ID: {{geneInfo.id}} ) </em><a href="{{geneInfo.url}}" target="_blank"><img src="/i/e-quest.gif" title="View in Ensembl" /></a></td>
                </tr>
                <tr>
                    <th>Description</th><td>{{geneInfo.description}}</td>
                </tr>
                <tr>
                    <th>Location</th><td>{{geneInfo.seq_region_name}} : {{geneInfo.start | number}} - {{geneInfo.end | number}} <em>{{geneInfo.strand_str}} strand</em></td>
                </tr>
                <tr>               
                    <th>Length</th><td> {{geneInfo.end - geneInfo.start + 1| number}}bp</td>
                </tr>
                <tr>
                    <td>
                        <em>Choose a transcript</em>
                    </td>
                    <td>
                        <ul class="nav nav-pills">
                
                        <li ng-repeat="transcript in geneInfo.Transcript" ng-class="{active:tab.isSet(transcript.id)}"
                                ng-click="tab.setTab(transcript.id)"><a href="#">{{transcript.id}} <em ng-show="transcript.Translation">({{transcript.protein.length}} aa)</em></a></li>
                    </ul>
                    
                    </td>
                </tr>
            </table>
            
            <div class="row" >
                <div class="col-xs-2 form-group col-fixed" id="myScrollspy" style="z-index:500">                        
                    <div class="input-group"  data-spy="affix" data-offset-top="0" id="positionBox">
                    <form role="form" class="form-horizontal">    
                        <input type="text" name="pos" class="form-control input-sm" placeholder="Enter position" ng-model="formInfo.pos"/>    
                        <table style="width:100%">
                            <tr>
                                <td style="width:10px">    
                                    <button type="submit" class="btn btn-success" ng-click="gi.findBP(tab)">bp</button>
                                </td>
                                <td style="width:10px">
                                    <button ng-show="tab.hasTranslation()" type="submit" class="btn btn-success" ng-click="gi.findAA(tab)">aa</button>
                                </td>
                                <td style="width:90%">&nbsp;</td>
                                <td style="text-align:right">
                                    <a href="#" onclick="window.scrollTo(0, 0);">top</a>
                                </td>
                            </tr>
                        </table>
                    
                        <div class="warn" ng-show="gi.foundSeq">{{ gi.foundSeq }}</div>
                        <div ng-show="tab.hasTranslation()">
                            <em>Coding sequence only:</em> <input type="checkbox" ng-model="formInfo.coding" ng-change="tab.setTab()" name="coding"/>
                        </div>
                        
                     </form>   
                    </div>
                </div>
                
                <div class="col-xs-7">
                    <div ng-show="loading" style="text-align:center">
                        Loading sequence ...
                    </div>                    
                    
                    <div ng-hide="formInfo.coding == true">
                    <!--
                        <div ng-mousedown="tab.click($event, $index)" ng-mouseleave="tab.untrack()" ng-mousemove="tab.track($event, $index)" class="sequence" id="a_{{$index}}" ng-repeat="segment in geneInfo.segments track by $index">
                            <table class="table-condensed">
                                <tr ng-show="geneInfo.psegments[$index].indexOf('-') > -1">
                                    <td class="num">{{geneInfo.isegments[$index]}}</td>
                                    <td><pre><span ng-bind-html="geneInfo.psegments[$index]"></span></pre></td>
                                    <td class="num">{{ geneInfo.isegments[$index] + baseCount(geneInfo.psegments[$index]) -1 }}</td>
                                </tr>
                                <tr>
                                    <td class="num">{{ ($index * formInfo.width) + 1 | number }}</td>
                                    <td><pre ><span ng-bind-html="geneInfo.segments[$index]"></span></pre></td>
                                    <td class="num">{{ ($index * formInfo.width) + baseCount(geneInfo.segments[$index]) | number }}</td>
                                </tr>
                            </table>
                        </div>
-->
                        <table>
                            <tr class="sequence" id="a_{{$index}}" ng-repeat="segment in geneInfo.segments track by $index">
                                <td>
                                    <table class="table-condensed">
                                <tr ng-show="geneInfo.psegments[$index].indexOf('-') > -1">
                                    <td class="num">{{geneInfo.isegments[$index]}}</td>
                                    <td><pre><span ng-bind-html="geneInfo.psegments[$index]"></span></pre></td>
                                    <td class="num">{{ geneInfo.isegments[$index] + baseCount(geneInfo.psegments[$index]) -1 }}</td>
                                </tr>
                                <tr>
                                    <td class="num">{{ ($index * formInfo.width) + 1 | number }}</td>
                                    <td><pre ><span ng-bind-html="geneInfo.segments[$index]"></span></pre></td>
                                    <td class="num">{{ ($index * formInfo.width) + baseCount(geneInfo.segments[$index]) | number }}</td>
                                </tr>
                            </table>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div ng-show="formInfo.coding == true">
                        <div ng-mousedown="tab.click($event, $index)" ng-mouseleave="tab.untrack()" ng-mousemove="tab.track($event, $index)"class="sequence" id="b_{{$index}}" ng-repeat="segment in geneInfo.csegments track by $index">
                            <table class="sequence">
                                <tr ng-show="geneInfo.pcsegments[$index].indexOf('-') > -1">
                                    <td class="num">{{geneInfo.icsegments[$index]}}:</td>
                                    <td><pre><span ng-bind-html="geneInfo.pcsegments[$index]"></span></pre></td>
                                    <td class="num">{{ geneInfo.icsegments[$index] + baseCount(geneInfo.pcsegments[$index]) -1 }}</td>
                                </tr>
                                <tr>
                                    <td class="num">{{ ($index * formInfo.width) + 1 | number }}:</td>
                                    <td><pre><span  class="exon" ng-bind-html="geneInfo.csegments[$index]"></span></pre></td>
                                    <td class="num">{{ ($index * formInfo.width) + baseCount(geneInfo.segments[$index]) | number }}</td>
                                </tr>                                        
                            </table>
                        </div>
                    </div>
                </div>

                
            </div>  
        </div>
    </div>
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.3/angular.min.js"></script>
    <script src="//code.angularjs.org/1.2.20/angular-sanitize.min.js"></script>
 
    <script type="text/javascript" src="/js/geneInfo.js"></script>
           <!-- for dialog boxes -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.10.0/ui-bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.10.0/ui-bootstrap-tpls.min.js"></script>


</body>
</html>
