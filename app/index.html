<!doctype html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" >
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="css/geneInfo.css">

    <!-- added to enable sticky goto box -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55089504-1', 'auto');
  //ga('send', 'pageview');

</script>  
</head>
<body ng-app="geneInfoApp" data-spy="scroll" data-target="#myScrollspy">
    <a id="top" name="top" href="#"></a>
    <div class="jumbotron">        
        <nav class="navbar navbar-default" role="navigation" ng-controller="menuCtrl as menu">
            <script type="text/ng-template" id="myModalContent.html">
                <div class="modal-header">
                    <h3>{{ items[0] }}</h3>
                </div>
                <div class="modal-body" ng-switch on="items[0]">
                    <p ng-switch-when="Contact">All enquires please contact ek@ebi.ac.uk</p>
                    <p ng-switch-when="About">geneSpy, version 0.3<br/>
                    Created by Eugene Kulesha<br/>
                    thanks to the ideas of Vera Grinkevich <br/>and e! REST API work of Magali Ruffier.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" ng-click="ok()">OK</button>            
                </div>
            </script>
            
            
            <a class="navbar-brand" href="#">geneSpy</a>
            
            <ul class="nav navbar-nav pull-right">
                <li><a href="#" ng-click="menu.show('Contact')">Contact</a></li>
                <li><a href="#" ng-click="menu.show('About')">About</a></li>
            </ul>            
        </nav>
    </div>
    <div style="display:none;visibility:hidden"><pre id="tmp">ATGC : {{ fontWidth }}</pre> : </div> 
    <div ng-controller="geneInfoCtrl as gi">
        <div class="row" style="padding-left:20px;padding-right:20px">
            <form>
            <div class="col-xs-3">
                <div class="input-group">
                    <input type="text" id="geneName" name="geneName" class="form-control" placeholder="Enter gene name" ng-model="formInfo.gene"/>    
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-success" ng-click="gi.findGene()">Find</button>
                    </span>
                </div>
            </div>                
            <div class="col-xs-9" style="text-align:right">
                <span>Species: </span>
                <select style="height:30px" ng-options="obj.name as obj.display_name + ' ('+obj.assembly+')' for obj in gi.speciesList | orderBy:' display_name'" ng-model="gi.species" ng-change="gi.update_blast()">
                </select>
            </div>
            <div ng-show="message" style="text-align:center" ng-cloak>
                <span style="background-color:pink;margin-top:10px;">{{ message }}</span>
            </div>           
        </form>
        </div>
        
        
        <div ng-show="geneInfo.id" ng-controller="TabController as tab" ng-cloak id="data">
        
            <div id="location" style="position: fixed;display:none;z-index:1000;background-color:#333333;padding:5px;opacity:0.9;color:#ffffff;"> {{ location }} </div>            
            
            <div id="blast" style="position:fixed;display:none;z-index:1000;padding:5px;opacity:1.0;">
                
                <form role="form" target="gs_blast" id="blast_form" name="blast_form" method="post" ng-submit="tab.goto_blast();" action="#">
                    <input type="hidden" name="query_sequence" value="{{blast_sequence}}" />
                    <input type="hidden" name="QUERY" value="{{blast_sequence}}" />
                    <input type="hidden" name="PAGE_TYPE" value="BlastSearch" />
                    <button type="submit" class="btn btn-success" name="stype" value="eblast" ng-click="tab.set_eblast()">eBLAST</button>
                    <button type="submit" class="btn btn-success" name="stype" value="nblast" ng-click="tab.set_nblast()">nBLAST</button>
                </form>
            </div>
            
            
            <div class="row" >
                <div class="col-xs-2 form-group col-fixed" id="myScrollspy" style="z-index:500">                        
                    <div class="input-group"  data-spy="affix" data-offset-top="0" id="positionBox">
                    <form role="form" class="form-horizontal">    
                        <input type="text" name="pos" class="form-control input-sm" placeholder="Enter position" ng-model="formInfo.pos"/>    <br/>
                        <table style="width:100%">
                            <tr>
                                <td style="width:10px">    
                                    <button type="submit" class="btn btn-success" ng-click="gi.findBP(tab)">bp</button>
                                </td>
                                <td style="width:10px">
                                    <button ng-show="tab.hasTranslation()" type="submit" class="btn btn-success" ng-click="gi.findAA(tab)">aa</button>
                                </td>
                                <td style="width:90%">&nbsp;</td>
                                <td style="text-align:right">
                                    <a href="#" onclick="window.scrollTo(0, 0);">top</a>
                                </td>
                            </tr>
                        </table>
                    
                        <div class="warn" ng-show="gi.foundSeq">{{ gi.foundSeq }}</div>
                        
                        <div ng-show="tab.hasCoding()">
                            <em>Coding sequence only:</em> <input type="checkbox" ng-model="formInfo.coding" ng-change="tab.setTab()" name="coding"/>
                        </div>
                        
                     </form>   
                    </div>
                </div>
                
                <div class="col-xs-8">
                
            <table class="table table-condensed table-striped" style="margin-left:15px;margin-right:15px;">
                <tr>
                    <th>Gene name</th><td><b>{{geneInfo.display_name}}</b> <em>(Ensembl ID: {{geneInfo.id}} ) </em><a href="{{geneInfo.url}}" target="_blank"><img src="i/e-quest.gif" title="View in Ensembl" /></a></td>
                </tr>
                <tr>
                    <th>Description</th><td>{{geneInfo.description}}</td>
                </tr>
                <tr>
                    <th>Location</th><td>{{geneInfo.seq_region_name}} : {{geneInfo.start | number}} - {{geneInfo.end | number}} <em>{{geneInfo.strand_str}} strand</em></td>
                </tr>
                <tr>               
                    <th>Length</th><td> {{geneInfo.end - geneInfo.start + 1| number}}bp</td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"> 
                                Choose a transcript
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                <li role="presentation" ng-repeat="transcript in geneInfo.Transcript | orderBy:'-plen'" ng-class="{active:tab.isSet(transcript.id)}"
                                ng-click="tab.setTab(transcript.id)"><a role="menuitem" tabindex="-1" href="#">{{transcript.id}} <span class="badge" ng-show="transcript.Translation">{{transcript.protein.length}} aa</span></a></li>
                            </ul>
                        </div>
                        
                        </td>
                    
                    </td>
                </tr>
            </table>
            
                
                    <div ng-show="loading" style="text-align:center">
                        Loading sequence ...
                    </div>                    
                                        
                    <div ng-hide="formInfo.coding == true">
                        <table>
                            <tr class="sequence" id="a_{{$index}}" ng-repeat="segment in geneInfo.segments track by $index">
                                <td>
                                    <table class="table-condensed">
                                        <tr ng-show="geneInfo.psegments[$index].indexOf('-') > -1">
                                            <td class="num">{{geneInfo.isegments[$index]}}:</td>
                                            <td><pre><span ng-bind-html="geneInfo.psegments[$index]"></span></pre></td>
                                            <td class="num">:{{ geneInfo.isegments[$index] + baseCount(geneInfo.psegments[$index]) -1 }}</td>
                                        </tr>
                                        <tr>
                                            <td class="num">{{ ($index * formInfo.width) + 1 | number }}</td>
                                            <td ng-click="tab.click()" ng-dblclick="tab.click()" ng-mousedown="tab.start_select($event, $index, 'bp')" ng-mouseup="tab.stop_select($event, $index, 'bp')" ng-mouseleave="tab.untrack()" ng-mousemove="tab.track($event, $index, 'bp')"><pre ><span ng-bind-html="geneInfo.segments[$index]"></span></pre></td>
                                            <td class="num">{{ ($index * formInfo.width) + baseCount(geneInfo.segments[$index]) | number }}</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div ng-show="formInfo.coding == true">
                        <div ng-hide="tab.hasTranslation()" class="warn">This transcript does not code for any proteins.</div>
                        <table ng-show="tab.hasTranslation()">
                            <tr class="sequence" id="a_{{$index}}" ng-repeat="segment in geneInfo.csegments track by $index">
                                <td>
                                    <table class="table-condensed">
                                        <tr ng-show="geneInfo.pcsegments[$index].indexOf('-') > -1">
                                            <td class="num">{{geneInfo.icsegments[$index]}}</td>
                                            <td><pre><span ng-bind-html="geneInfo.pcsegments[$index]"></span></pre></td>
                                            <td class="num">{{ geneInfo.icsegments[$index] + baseCount(geneInfo.pcsegments[$index]) -1 }}</td>
                                        </tr>
                                        <tr>
                                            <td class="num">{{ ($index * formInfo.width) + 1 | number }}</td>
                                            <td ng-click="tab.click()" ng-dblclick="tab.click()" ng-mousedown="tab.start_select($event, $index, 'bp')" ng-mouseup="tab.stop_select($event, $index, 'bp')" ng-mouseleave="tab.untrack()" ng-mousemove="tab.track($event, $index, 'bp')">
                                                <pre ><span class="exon" ng-bind-html="geneInfo.csegments[$index]"></span></pre></td>
                                            <td class="num">{{ ($index * formInfo.width) + baseCount(geneInfo.csegments[$index]) | number }}</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>

                
            </div>  
        </div>
    </div>
    <div style="height:30px">&nbsp;</div>
    <div id="footer" class="panel-footer">        
        <div class="container text-center">
            <p class="text-muted credit">Powered by <a href="http://rest.ensembl.org"><img src="i/e-quest.gif" /> REST API</a></p>
        </div>
    </div>
        
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.3/angular.min.js"></script>
    <script src="//code.angularjs.org/1.2.20/angular-sanitize.min.js"></script>
 
    <script type="text/javascript" src="js/geneInfo.js"></script>
           <!-- for dialog boxes -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.10.0/ui-bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.10.0/ui-bootstrap-tpls.min.js"></script>

    
</body>
</html>
